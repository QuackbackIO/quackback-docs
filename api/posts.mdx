---
title: "Posts API"
description: "Create, read, update, and manage feedback posts programmatically."
icon: "file-text"
---

# Posts API

Manage feedback programmatically. Create posts, update statuses, handle votes, and find duplicates. Everything you need to integrate Quackback into your workflow.

## Overview

The Posts API covers the full lifecycle of feedback: creating posts, changing statuses, managing votes, and detecting duplicates before they're submitted. Uses TanStack Start server functions for type-safe integration.

## Authentication

Server functions use `requireAuth()` to verify authentication:

- **Public functions** (like `listPublicPostsFn`, `findSimilarPostsFn`) do not require authentication
- **Portal functions** (like `createPublicPostFn`, `toggleVoteFn`) require any authenticated user
- **Admin functions** (like `createPostFn`, `updatePostFn`) require `admin` or `member` roles

## Public Posts

### List Public Posts

Retrieve a paginated list of public posts with filtering and sorting.

**Function:** `listPublicPostsFn`

**Method:** `GET`

**Authentication:** None required

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `boardSlug` | `string` | - | Filter by board slug |
| `search` | `string` | - | Full-text search query |
| `statusIds` | `string[]` | - | Filter by status IDs |
| `statusSlugs` | `string[]` | - | Filter by status slugs (preferred) |
| `tagIds` | `string[]` | - | Filter by tag IDs |
| `sort` | `'top' \| 'new' \| 'trending'` | `'top'` | Sort order |
| `page` | `number` | `1` | Page number (1-indexed) |
| `limit` | `number` | `20` | Items per page (max: 100) |

**Response:**

```typescript
{
  items: Array<{
    id: string                    // Post ID (TypeID format: post_xxx)
    title: string
    content: string | null
    statusId: string | null
    voteCount: number
    commentCount: number
    authorName: string | null
    memberId: string | null
    createdAt: string            // ISO 8601 datetime
    tags: Array<{
      id: string
      name: string
      color: string
    }>
    board: {
      id: string
      name: string
      slug: string
    }
  }>
  total: number
  hasMore: boolean
}
```

**Example:**

```typescript
import { listPublicPostsFn } from '@/lib/server/functions/public-posts'

// List top posts from the "feature-requests" board
const result = await listPublicPostsFn({
  data: {
    boardSlug: 'feature-requests',
    sort: 'top',
    page: 1,
    limit: 20,
  },
})

console.log(result.items) // Array of posts
console.log(result.hasMore) // true if more pages available
```

### Find Similar Posts

Search for posts similar to a given title using hybrid vector + full-text search. Useful for duplicate detection when creating new posts.

**Function:** `findSimilarPostsFn`

**Method:** `GET`

**Authentication:** None required

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `title` | `string` | - | Search query (3-200 chars) |
| `limit` | `number` | `5` | Max results (1-10) |

**Response:**

```typescript
Array<{
  id: string
  title: string
  voteCount: number
  status: {
    name: string
    color: string
  } | null
  boardSlug: string
  matchStrength: 'strong' | 'good' | 'weak'  // strong: 50%+, good: 40-50%, weak: 35-40%
}>
```

**Example:**

```typescript
import { findSimilarPostsFn } from '@/lib/server/functions/public-posts'

// Find posts similar to a potential new post
const similar = await findSimilarPostsFn({
  data: {
    title: 'Add dark mode support',
    limit: 5,
  },
})

if (similar.length > 0) {
  console.log('Similar posts found:', similar)
  // Show user potential duplicates before they submit
}
```

## Create posts

### Create Post (Admin)

Create a new post as an admin or team member. The post is attributed to the authenticated member.

**Function:** `createPostFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `title` | `string` | Yes | Post title (1-200 chars) |
| `content` | `string` | No | Post content (max 10,000 chars, defaults to empty string) |
| `contentJson` | `TiptapContent` | No | Rich text content as Tiptap JSON |
| `boardId` | `string` | Yes | Board ID to post to |
| `statusId` | `string` | No | Initial status (defaults to "Open") |
| `tagIds` | `string[]` | No | Tag IDs to apply |

**Response:**

```typescript
{
  id: string                      // Created post ID
  title: string
  content: string
  contentJson: TiptapContent | null
  statusId: string | null
  voteCount: number
  boardId: string
  memberId: string
  boardSlug: string
  createdAt: string
  updatedAt: string
  deletedAt: string | null
  officialResponseAt: string | null
}
```

**Example:**

```typescript
import { createPostFn } from '@/lib/server/functions/posts'

const post = await createPostFn({
  data: {
    title: 'Add export to CSV feature',
    content: 'It would be great to export our feedback data to CSV format for analysis.',
    boardId: 'board_01h455vb4pex5vsknk084sn02q',
    tagIds: ['tag_01h455vb4pex5vsknk084sn02q'],
  },
})

console.log('Created post:', post.id)
```

### Create Post (Public Portal)

Create a post from the public feedback portal. Requires authentication as any user.

**Function:** `createPublicPostFn`

**Method:** `POST`

**Authentication:** Any authenticated user

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `boardId` | `string` | Yes | Board ID (must be a public board) |
| `title` | `string` | Yes | Post title (1-200 chars) |
| `content` | `string` | No | Post content (max 10,000 chars, defaults to empty string) |
| `contentJson` | `TiptapContent` | No | Rich text content |

**Response:**

```typescript
{
  id: string
  title: string
  content: string
  statusId: string | null
  voteCount: number
  createdAt: string
  board: {
    id: string
    name: string
    slug: string
  }
}
```

**Example:**

```typescript
import { createPublicPostFn } from '@/lib/server/functions/public-posts'

const post = await createPublicPostFn({
  data: {
    boardId: 'board_01h455vb4pex5vsknk084sn02q',
    title: 'Dark mode for mobile app',
    content: 'Please add dark mode support to the mobile application.',
  },
})
```

## Update posts

### Update Post (Admin)

Update an existing post. Team members can update any post.

**Function:** `updatePostFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID to update |
| `title` | `string` | No | New title (1-200 chars) |
| `content` | `string` | No | New content (max 10,000 chars) |
| `contentJson` | `TiptapContent` | No | Rich text content |
| `ownerId` | `string \| null` | No | Assign owner member ID |
| `officialResponse` | `string \| null` | No | Official response text (max 5,000 chars) |

**Example:**

```typescript
import { updatePostFn } from '@/lib/server/functions/posts'

const updated = await updatePostFn({
  data: {
    id: 'post_01h455vb4pex5vsknk084sn02q',
    title: 'Updated: Add export to CSV feature',
    officialResponse: 'This feature is now on our roadmap for Q2!',
  },
})
```

### User Edit Post

Allow users to edit their own posts from the portal. Subject to engagement restrictions.

**Function:** `userEditPostFn`

**Method:** `POST`

**Authentication:** Post author required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `postId` | `string` | Yes | Post ID to edit |
| `title` | `string` | Yes | New title |
| `content` | `string` | Yes | New content |
| `contentJson` | `TiptapContent` | No | Rich text content |

<Note>
**Edit Restrictions:**

Users can only edit their own posts when:
- The post has not been reviewed by the team (status is still "Open")
- The post has no votes (unless `allowEditAfterEngagement` is enabled)
- The post has no comments from other users (unless `allowEditAfterEngagement` is enabled)

Team members can always edit any post.
</Note>

### Change Status

Change the status of a post.

**Function:** `changePostStatusFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID |
| `statusId` | `string` | Yes | New status ID |

**Example:**

```typescript
import { changePostStatusFn } from '@/lib/server/functions/posts'

const result = await changePostStatusFn({
  data: {
    id: 'post_01h455vb4pex5vsknk084sn02q',
    statusId: 'status_01h455vb4pex5vsknk084sn02q', // e.g., "In Progress"
  },
})
```

### Update Tags

Update the tags assigned to a post.

**Function:** `updatePostTagsFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID |
| `tagIds` | `string[]` | Yes | Array of tag IDs (replaces existing tags) |

## Delete posts

### Delete Post (Admin)

Soft delete a post. The post remains in the database but is hidden from public views.

**Function:** `deletePostFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID to delete |

### User Delete Post

Allow users to delete their own posts from the portal.

**Function:** `userDeletePostFn`

**Method:** `POST`

**Authentication:** Post author required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `postId` | `string` | Yes | Post ID to delete |

<Note>
**Delete Restrictions:**

Users can only delete their own posts when:
- The post has not been reviewed by the team
- The post has no votes (unless `allowDeleteAfterEngagement` is enabled)
- The post has no comments (unless `allowDeleteAfterEngagement` is enabled)
</Note>

### Restore Post

Restore a soft-deleted post.

**Function:** `restorePostFn`

**Method:** `POST`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID to restore |

## Voting

### Toggle Vote

Vote or unvote on a post. If the user has already voted, the vote is removed.

**Function:** `toggleVoteFn`

**Method:** `POST`

**Authentication:** Any authenticated user

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `postId` | `string` | Yes | Post ID to vote on |

**Response:**

```typescript
{
  voted: boolean     // true if user now has a vote, false if vote was removed
  voteCount: number  // Updated total vote count
}
```

**Example:**

```typescript
import { toggleVoteFn } from '@/lib/server/functions/public-posts'

const result = await toggleVoteFn({
  data: {
    postId: 'post_01h455vb4pex5vsknk084sn02q',
  },
})

if (result.voted) {
  console.log('Vote added! Total votes:', result.voteCount)
} else {
  console.log('Vote removed. Total votes:', result.voteCount)
}
```

### Get Voted Posts

Get all post IDs that the current user has voted on.

**Function:** `getVotedPostsFn`

**Method:** `GET`

**Authentication:** Optional (returns empty array if not authenticated)

**Response:**

```typescript
{
  votedPostIds: string[]
}
```

**Example:**

```typescript
import { getVotedPostsFn } from '@/lib/server/functions/public-posts'

const { votedPostIds } = await getVotedPostsFn()
const votedSet = new Set(votedPostIds)

// Check if user voted on a specific post
if (votedSet.has(postId)) {
  // Show "voted" state in UI
}
```

## Fetch post details

### Fetch Post with Details (Admin)

Get a single post with full details including comments and vote status.

**Function:** `fetchPostWithDetails`

**Method:** `GET`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `string` | Yes | Post ID |

**Response:**

```typescript
{
  id: string
  title: string
  content: string
  contentJson: TiptapContent | null
  statusId: string | null
  voteCount: number
  boardId: string
  memberId: string | null
  authorName: string | null
  authorEmail: string | null
  createdAt: string
  updatedAt: string
  deletedAt: string | null
  officialResponse: string | null
  officialResponseAt: string | null
  officialResponseMemberId: string | null
  officialResponseAuthorName: string | null

  // Related data
  board: {
    id: string
    name: string
    slug: string
  }
  tags: Array<{
    id: string
    name: string
    color: string
  }>
  roadmapIds: string[]
  hasVoted: boolean

  // Comments
  comments: Array<{
    id: string
    content: string
    authorName: string | null
    memberId: string | null
    isTeamMember: boolean
    createdAt: string
    reactions: Array<{
      emoji: string
      count: number
      hasReacted: boolean
    }>
    replies: Array<...>  // Nested comment tree
  }>

  // Pinned official response
  pinnedComment: {
    id: string
    content: string
    authorName: string | null
    memberId: string | null
    avatarUrl: string | null
    createdAt: string
    isTeamMember: boolean
  } | null
}
```

### Fetch Inbox Posts (Admin)

List posts for the admin inbox with advanced filtering.

**Function:** `fetchInboxPostsForAdmin`

**Method:** `GET`

**Authentication:** `admin` or `member` role required

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `boardIds` | `string[]` | - | Filter by board IDs |
| `statusIds` | `string[]` | - | Filter by status IDs |
| `statusSlugs` | `string[]` | - | Filter by status slugs |
| `tagIds` | `string[]` | - | Filter by tag IDs |
| `ownerId` | `string \| null` | - | Filter by owner (null = unassigned) |
| `search` | `string` | - | Full-text search query |
| `dateFrom` | `string` | - | Filter by creation date (ISO 8601) |
| `dateTo` | `string` | - | Filter by creation date (ISO 8601) |
| `minVotes` | `number` | - | Minimum vote count |
| `sort` | `'newest' \| 'oldest' \| 'votes'` | `'newest'` | Sort order |
| `page` | `number` | `1` | Page number |
| `limit` | `number` | `20` | Items per page (max: 100) |

## Permissions

### Get Post Permissions

Check if the current user can edit or delete a post.

**Function:** `getPostPermissionsFn`

**Method:** `GET`

**Authentication:** Optional

**Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `postId` | `string` | Yes | Post ID to check |

**Response:**

```typescript
{
  canEdit: boolean
  canDelete: boolean
  editReason?: string    // Explanation if canEdit is false
  deleteReason?: string  // Explanation if canDelete is false
}
```

## Roadmap Posts

### List Public Roadmaps

Get all public roadmaps.

**Function:** `listPublicRoadmapsFn`

**Method:** `GET`

**Authentication:** None required

### Get Roadmap Posts

Get posts associated with a public roadmap.

**Function:** `getPublicRoadmapPostsFn`

**Method:** `GET`

**Authentication:** None required

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `roadmapId` | `string` | - | Roadmap ID |
| `statusId` | `string` | - | Filter by status |
| `limit` | `number` | `20` | Items per page |
| `offset` | `number` | `0` | Starting offset |

## Error Handling

All server functions throw typed errors that can be caught and handled:

```typescript
import { NotFoundError, ValidationError, ForbiddenError } from '@/lib/shared/errors'

try {
  await updatePostFn({ data: { id: 'invalid_id', title: 'New Title' } })
} catch (error) {
  if (error instanceof NotFoundError) {
    console.error('Post not found:', error.message)
  } else if (error instanceof ValidationError) {
    console.error('Invalid input:', error.message)
  } else if (error instanceof ForbiddenError) {
    console.error('Not authorized:', error.message)
  }
}
```

<Tip>
## TypeID Format

All IDs in Quackback use TypeID format, which is a branded UUID with a type prefix. This provides type safety at the TypeScript level and makes IDs self-documenting in logs and databases.
</Tip>

Example IDs:

- Posts: `post_01h455vb4pex5vsknk084sn02q`
- Boards: `board_01h455vb4pex5vsknk084sn02q`
- Statuses: `status_01h455vb4pex5vsknk084sn02q`
- Tags: `tag_01h455vb4pex5vsknk084sn02q`
- Members: `member_01h455vb4pex5vsknk084sn02q`
