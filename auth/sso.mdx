---
title: "Set up single sign-on"
description: "Let users sign in with their existing work accounts via OIDC."
icon: "building"
---

# Set up single sign-on

One less password for your users to remember. SSO lets customers sign in with their existing work accounts. Faster onboarding, better security, and no more "forgot password" requests.

## Overview

Quackback supports SSO through OpenID Connect (OIDC), which works with most modern identity providers:

| Provider | Discovery URL Format |
|----------|---------------------|
| Okta | `https://your-org.okta.com` |
| Azure AD | `https://login.microsoftonline.com/{tenant}/v2.0` |
| Google Workspace | `https://accounts.google.com` |
| Auth0 | `https://your-tenant.auth0.com` |
| Keycloak | `https://keycloak.example.com/realms/{realm}` |
| OneLogin | `https://your-org.onelogin.com/oidc/2` |

## Portal SSO vs Team SSO

You can configure SSO for two different audiences:

| Feature | Portal SSO | Team SSO |
|---------|-----------|----------|
| Purpose | Customer authentication | Employee authentication |
| Location | Admin → Settings → Portal Authentication | Admin → Settings → Security |
| Enforcement | Always optional | Optional or required |
| Other methods | Can coexist with email/OAuth | Can disable other methods |

## Before You Start

You'll need from your identity provider:

1. **A registered application/client** with:
   - Client ID
   - Client secret
   - OIDC discovery endpoint (`.well-known/openid-configuration`)

2. **Required OIDC scopes**: `openid`, `email`, `profile`

3. **Callback URL** to add to your IdP:
   ```
   https://your-domain.com/api/auth/callback/oidc
   ```

## Set up portal SSO

Let customers sign in with your identity provider:

1. Go to **Admin → Settings → Portal Authentication**
2. Click the gear icon next to **Custom OpenID Connect**
3. Configure:

| Field | What to enter | Example |
|-------|---------------|---------|
| Button Label | Text on login button | `Acme Corp SSO` |
| Issuer URL | OIDC discovery base URL | `https://acme.okta.com` |
| Client ID | Application client ID | `0oa1bcdef...` |
| Client Secret | Application client secret | `abc123...` |
| Email Domain | Restrict to domain (optional) | `acme.com` |

4. Click **Test** to verify the issuer URL
5. Click **Save & Enable**

The login page now shows "Continue with Acme Corp SSO".

## Set up team SSO

Require or allow team members to use SSO:

1. Go to **Admin → Settings → Security**
2. Configure the SSO provider (same fields as Portal SSO)
3. Choose enforcement:

| Enforcement | What happens |
|-------------|--------------|
| Optional | Team can use SSO or other enabled methods |
| Required | Team must use SSO |

<Warning>
When SSO is required, other sign-in methods (GitHub, Google) are disabled for team members. Email OTP stays available as a recovery option for admins.
</Warning>

## Provider-Specific Setup

### Okta

1. Create a new **Web Application** in Okta Admin Console
2. Configure:
   - **Sign-in redirect URI**: `https://your-domain.com/api/auth/callback/oidc`
   - **Sign-out redirect URI**: `https://your-domain.com`
   - **Assignments**: Assign users or groups
3. Copy the **Client ID** and **Client Secret**
4. Use `https://your-org.okta.com` as the Issuer URL

### Azure AD

1. Register an application in Azure Portal → App Registrations
2. Configure:
   - **Redirect URI**: `https://your-domain.com/api/auth/callback/oidc` (Web platform)
   - **Supported account types**: Based on your requirements
3. Create a client secret in **Certificates & secrets**
4. Use `https://login.microsoftonline.com/{tenant-id}/v2.0` as Issuer URL

### Google Workspace

1. Create OAuth credentials in Google Cloud Console
2. Configure:
   - **Authorized redirect URIs**: `https://your-domain.com/api/auth/callback/oidc`
   - **OAuth consent screen**: Configure for your organization
3. Use `https://accounts.google.com` as Issuer URL

### Auth0

1. Create a **Regular Web Application** in Auth0 Dashboard
2. Configure:
   - **Allowed Callback URLs**: `https://your-domain.com/api/auth/callback/oidc`
   - **Allowed Logout URLs**: `https://your-domain.com`
3. Use `https://your-tenant.auth0.com` as Issuer URL

## Test SSO

After configuration:

1. **Test Discovery**: Click the "Test" button to verify Quackback can reach the IdP
2. **Test Login**: Open an incognito window and try signing in with SSO
3. **Verify User Creation**: Check that the user appears in your user list

### Checklist

- [ ] Discovery endpoint responds correctly
- [ ] Login redirects to IdP
- [ ] IdP authentication succeeds
- [ ] Callback returns to Quackback
- [ ] User is created/logged in
- [ ] Email domain restriction works (if configured)

## Restrict by email domain

Want to limit SSO to users with specific email domains?

1. Enter the domain (without `@`) in the **Email Domain Restriction** field
2. Only users with matching email domains can sign in

Example: Setting `acme.com` only allows `user@acme.com`, not `user@gmail.com`.

## Security Notes

### PKCE

Quackback uses PKCE (Proof Key for Code Exchange) for all OIDC flows, protecting against authorization code interception attacks.

### Secret Storage

Client secrets are encrypted at rest using AES-256-GCM before being stored. The encryption key is derived from your `SECRET_KEY` environment variable.

### Sessions

SSO sessions work the same as other auth methods:
- 7-day session duration
- Sessions refresh on activity
- Logout invalidates the session

## Troubleshooting

### "Provider missing required endpoints"

The issuer URL doesn't have a valid OIDC discovery document.

**Fix:**
1. Verify the issuer URL is correct
2. Check if the IdP is accessible from your server
3. Ensure `.well-known/openid-configuration` endpoint is available

### "Token exchange failed"

The authorization code couldn't be exchanged for tokens.

**Fix:**
1. Verify client ID and secret are correct
2. Check the callback URL matches exactly
3. Ensure the IdP application is active

### "Missing email claim"

The IdP didn't return an email address.

**Fix:**
1. Ensure `email` scope is requested
2. Check user profile has an email address in IdP
3. Verify email claim is included in ID token

### "Email domain mismatch"

User's email doesn't match the configured domain restriction.

**Fix:**
1. Verify the user's email domain
2. Check domain restriction is configured correctly
3. Remove domain restriction if not needed

### Locked out after enabling required SSO?

An admin can still sign in via email OTP. Once logged in, adjust SSO settings or fix the IdP configuration.

## Remove SSO

### Portal SSO

1. Go to **Admin → Settings → Portal Authentication**
2. Click the gear icon next to OIDC
3. Click **Remove**

### Team SSO

1. Go to **Admin → Settings → Security**
2. Disable SSO or change enforcement to optional
3. Optionally remove the provider configuration

<Note>
Existing users who signed up via SSO can still sign in using email OTP. Accounts are linked by email address.
</Note>

## SAML Support

Quackback currently supports OIDC for SSO. SAML support may be added in a future release.

Most identity providers support both OIDC and SAML. If your organization requires SAML specifically, check if your IdP can expose an OIDC interface for the same users/groups.

## Next Steps

- [OAuth](/auth/oauth) - Configure GitHub/Google sign-in
- [Email OTP](/auth/email-otp) - Passwordless authentication
- [Authentication Overview](/auth/overview) - Complete auth documentation
