---
title: "Reverse Proxy Configuration"
description: "Configure a reverse proxy to serve Quackback securely with SSL/TLS termination"
icon: "shield"
---

# Reverse Proxy Configuration

Configure a reverse proxy to serve Quackback securely with SSL/TLS termination.

## Why Use a Reverse Proxy?

A reverse proxy provides:

- **SSL/TLS termination** - Secure HTTPS connections
- **Load balancing** - Distribute traffic across instances
- **Caching** - Improve performance for static assets
- **Security** - Hide application server details
- **Compression** - Reduce bandwidth usage

<Warning>
Always use a reverse proxy in production. Never expose port 3000 directly to the internet.
</Warning>

## Headers to Set

All reverse proxy configurations should pass these headers:

| Header | Purpose |
|--------|---------|
| `Host` | Original hostname |
| `X-Real-IP` | Client IP address |
| `X-Forwarded-For` | Proxy chain |
| `X-Forwarded-Proto` | Protocol (http/https) |
| `Upgrade` | WebSocket support |
| `Connection` | Keep-alive handling |

## Nginx

### Full Configuration with SSL

Create `/etc/nginx/sites-available/quackback`:

```nginx
# Redirect HTTP to HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name feedback.yourcompany.com;

    # ACME challenge for Let's Encrypt
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$server_name$request_uri;
    }
}

# HTTPS server
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name feedback.yourcompany.com;

    # SSL certificates
    ssl_certificate /etc/letsencrypt/live/feedback.yourcompany.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/feedback.yourcompany.com/privkey.pem;

    # SSL configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_stapling on;
    ssl_stapling_verify on;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # Logging
    access_log /var/log/nginx/quackback_access.log;
    error_log /var/log/nginx/quackback_error.log;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;

    # Client settings
    client_max_body_size 10M;

    # Proxy to Quackback
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;

        # Headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;

        # WebSocket support
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # Buffering
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
    }

    # Static assets with caching
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Cache static assets
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

Enable the site:

```bash
sudo ln -s /etc/nginx/sites-available/quackback /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### Obtain SSL Certificate with Certbot

```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d feedback.yourcompany.com

# Auto-renewal (usually set up automatically)
sudo certbot renew --dry-run
```

## Caddy

<Tip>
Caddy automatically handles SSL certificates with Let's Encrypt, making it the easiest option for quick setup.
</Tip>

### Caddyfile

Create `/etc/caddy/Caddyfile`:

```
feedback.yourcompany.com {
    # Automatic HTTPS with Let's Encrypt

    # Proxy to Quackback
    reverse_proxy localhost:3000 {
        # Health checks
        health_uri /
        health_interval 30s
        health_timeout 5s

        # Headers
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Compression
    encode gzip zstd

    # Security headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    # Logging
    log {
        output file /var/log/caddy/quackback.log
        format json
    }
}
```

### Multiple Domains

For different domains pointing to the same instance:

```
feedback.yourcompany.com, feedback.example.org {
    reverse_proxy localhost:3000
}
```

### With Custom SSL Certificates

```
feedback.yourcompany.com {
    tls /path/to/cert.pem /path/to/key.pem

    reverse_proxy localhost:3000
}
```

Start Caddy:

```bash
sudo systemctl enable caddy
sudo systemctl start caddy
```

## Traefik

### Docker Compose Labels

Add labels to your Quackback container in `docker-compose.yml`:

```yaml
version: '3.8'

services:
  quackback:
    image: ghcr.io/quackbackhq/quackback:latest
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/quackback
      - BETTER_AUTH_SECRET=your-secret
      - BETTER_AUTH_URL=https://feedback.yourcompany.com
      - ROOT_URL=https://feedback.yourcompany.com
    labels:
      - "traefik.enable=true"
      # Router
      - "traefik.http.routers.quackback.rule=Host(`feedback.yourcompany.com`)"
      - "traefik.http.routers.quackback.entrypoints=websecure"
      - "traefik.http.routers.quackback.tls=true"
      - "traefik.http.routers.quackback.tls.certresolver=letsencrypt"
      # Service
      - "traefik.http.services.quackback.loadbalancer.server.port=3000"
      # Middlewares
      - "traefik.http.routers.quackback.middlewares=security-headers"
      - "traefik.http.middlewares.security-headers.headers.stsSeconds=31536000"
      - "traefik.http.middlewares.security-headers.headers.stsIncludeSubdomains=true"
      - "traefik.http.middlewares.security-headers.headers.frameDeny=true"
      - "traefik.http.middlewares.security-headers.headers.contentTypeNosniff=true"
    networks:
      - traefik-public

  traefik:
    image: traefik:v3.0
    command:
      - "--api.dashboard=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
      - "--certificatesresolvers.letsencrypt.acme.httpchallenge=true"
      - "--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web"
      - "--certificatesresolvers.letsencrypt.acme.email=admin@yourcompany.com"
      - "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "letsencrypt:/letsencrypt"
    networks:
      - traefik-public

networks:
  traefik-public:
    external: true

volumes:
  letsencrypt:
```

### Static Configuration (traefik.yml)

For file-based configuration:

```yaml
# /etc/traefik/traefik.yml
entryPoints:
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
  websecure:
    address: ":443"

providers:
  file:
    directory: /etc/traefik/conf.d
    watch: true

certificatesResolvers:
  letsencrypt:
    acme:
      email: admin@yourcompany.com
      storage: /etc/traefik/acme.json
      httpChallenge:
        entryPoint: web

log:
  level: INFO

accessLog: {}
```

Dynamic configuration:

```yaml
# /etc/traefik/conf.d/quackback.yml
http:
  routers:
    quackback:
      rule: "Host(`feedback.yourcompany.com`)"
      service: quackback
      tls:
        certResolver: letsencrypt
      middlewares:
        - security-headers

  services:
    quackback:
      loadBalancer:
        servers:
          - url: "http://localhost:3000"

  middlewares:
    security-headers:
      headers:
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "strict-origin-when-cross-origin"
```

## Apache

### Basic Configuration

Create `/etc/apache2/sites-available/quackback.conf`:

```apache
<VirtualHost *:80>
    ServerName feedback.yourcompany.com
    Redirect permanent / https://feedback.yourcompany.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName feedback.yourcompany.com

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/feedback.yourcompany.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/feedback.yourcompany.com/privkey.pem

    # SSL Settings
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/quackback_error.log
    CustomLog ${APACHE_LOG_DIR}/quackback_access.log combined

    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off

    # Headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"

    # Proxy to Quackback
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/

    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]
</VirtualHost>
```

Enable required modules and site:

```bash
sudo a2enmod proxy proxy_http proxy_wstunnel ssl headers rewrite
sudo a2ensite quackback
sudo apache2ctl configtest
sudo systemctl reload apache2
```

## SSL/TLS Recommendations

### Minimum Requirements

- TLS 1.2 or higher (disable TLS 1.0, 1.1)
- Strong cipher suites (prefer ECDHE, disable RC4, 3DES)
- HSTS enabled (minimum 1 year)

### Certificate Options

| Option | Cost | Setup |
|--------|------|-------|
| Let's Encrypt | Free | Automatic with Certbot |
| Cloudflare | Free | DNS proxy |
| Commercial CA | Paid | Manual or API |

### HSTS Configuration

<Info>
Always enable HSTS for production to ensure browsers only connect via HTTPS.
</Info>

```
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
```

Consider HSTS preloading at https://hstspreload.org/

### Certificate Renewal

Let's Encrypt certificates expire after 90 days. Set up automatic renewal:

```bash
# Test renewal
sudo certbot renew --dry-run

# Cron job (usually added by Certbot)
0 0,12 * * * root /usr/bin/certbot renew --quiet
```

## Load Balancing

### Nginx Upstream

For multiple Quackback instances:

```nginx
upstream quackback {
    least_conn;
    server 127.0.0.1:3000 weight=1;
    server 127.0.0.1:3001 weight=1;
    server 127.0.0.1:3002 weight=1;

    # Health checks
    keepalive 32;
}

server {
    location / {
        proxy_pass http://quackback;
        # ... other settings
    }
}
```

### Sticky Sessions

If using multiple instances, sticky sessions ensure users stay on the same instance:

```nginx
upstream quackback {
    ip_hash;  # Sticky sessions based on client IP
    server 127.0.0.1:3000;
    server 127.0.0.1:3001;
}
```

## Testing Configuration

### SSL Labs Test

Test your SSL configuration at https://www.ssllabs.com/ssltest/

<Tip>
Aim for an A+ rating on SSL Labs to ensure your configuration follows security best practices.
</Tip>

### Header Test

Check security headers at https://securityheaders.com/

### Verify Proxy Headers

```bash
# Check headers are passed correctly
curl -I https://feedback.yourcompany.com

# Check application receives correct headers
curl http://localhost:3000 -H "X-Forwarded-Proto: https" -H "X-Forwarded-For: 1.2.3.4"
```

## Troubleshooting

### 502 Bad Gateway

- Verify Quackback is running: `curl http://localhost:3000`
- Check proxy_pass address matches application port
- Review proxy error logs

### WebSocket Connection Failed

Ensure WebSocket upgrade headers are configured:
```nginx
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
```

### Mixed Content Warnings

Ensure `X-Forwarded-Proto: https` header is passed and `ROOT_URL` uses HTTPS.

### Redirect Loops

Check that both `ROOT_URL` and `BETTER_AUTH_URL` in `.env` use `https://`.

## Next Steps

- [Environment Variables](/reference/environment-variables) - Configure email, OAuth, and integrations
- [Docker Deployment](/self-hosting/docker) - Container-based deployment
- [Troubleshooting](/self-hosting/troubleshooting) - Common issues and solutions
